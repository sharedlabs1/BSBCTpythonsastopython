== Lab: Logging in Python

=== Objective
This lab provides a comprehensive understanding of logging in Python, including:

1. The importance of logging.
2. Types of logging.
3. Log levels.
4. Logging destinations.
5. Creating a logging system for a real-world use case.

=== Step 1: Introduction to Logging

#### Why Logging?
- Helps monitor application behavior.
- Assists in debugging and error tracking.
- Useful for auditing and tracking system events.

#### Types of Logging
1. **Application Logs**: Logs generated by the application to track events or errors.
2. **System Logs**: Logs from the operating system or infrastructure.
3. **Audit Logs**: Logs for security and compliance tracking.

#### Log Levels
1. **DEBUG**: Detailed information, typically for diagnosing problems.
2. **INFO**: Confirmation that things are working as expected.
3. **WARNING**: Indication of potential problems.
4. **ERROR**: Logs an error that has occurred.
5. **CRITICAL**: Logs severe errors causing program termination.

=== Step 2: Basic Logging Configuration

#### Setting Up Logging

[source,python]
----
import logging

# Basic configuration
logging.basicConfig(
    level=logging.DEBUG,
    format='%(asctime)s - %(levelname)s - %(message)s',
    datefmt='%Y-%m-%d %H:%M:%S'
)

# Test logging levels
logging.debug("This is a DEBUG message")
logging.info("This is an INFO message")
logging.warning("This is a WARNING message")
logging.error("This is an ERROR message")
logging.critical("This is a CRITICAL message")
----

=== Step 3: Logging to a File

#### Writing Logs to a File

[source,python]
----
# Configure logging to write to a file
logging.basicConfig(
    filename='application.log',
    level=logging.INFO,
    format='%(asctime)s - %(levelname)s - %(message)s',
    datefmt='%Y-%m-%d %H:%M:%S'
)

# Log messages
logging.info("Application started")
logging.warning("This is a warning message")
logging.error("An error occurred")
----

=== Step 4: Advanced Logging with Handlers

#### Adding Multiple Handlers

[source,python]
----
# Create logger
logger = logging.getLogger('AdvancedLogger')
logger.setLevel(logging.DEBUG)

# Create file handler
file_handler = logging.FileHandler('advanced.log')
file_handler.setLevel(logging.ERROR)

# Create console handler
console_handler = logging.StreamHandler()
console_handler.setLevel(logging.DEBUG)

# Create formatter
formatter = logging.Formatter('%(asctime)s - %(name)s - %(levelname)s - %(message)s')
file_handler.setFormatter(formatter)
console_handler.setFormatter(formatter)

# Add handlers to logger
logger.addHandler(file_handler)
logger.addHandler(console_handler)

# Log messages
logger.debug("This is a DEBUG message")
logger.info("This is an INFO message")
logger.warning("This is a WARNING message")
logger.error("This is an ERROR message")
logger.critical("This is a CRITICAL message")
----

=== Step 5: Logging to External Destinations

#### Logging to JSON File

[source,python]
----
import json

class JSONFileHandler(logging.FileHandler):
    def emit(self, record):
        log_entry = {
            "timestamp": self.formatTime(record),
            "level": record.levelname,
            "message": record.msg
        }
        with open(self.baseFilename, 'a') as log_file:
            log_file.write(json.dumps(log_entry) + '\n')

# Configure JSON file handler
json_handler = JSONFileHandler('logs.json')
json_handler.setFormatter(logging.Formatter('%(asctime)s'))
logger.addHandler(json_handler)

logger.info("This log is written to a JSON file")
----

=== Step 6: Case Study: Insurance Policy Management Logging

#### Scenario
An insurance company wants to log events in their policy management system, including:
1. Policy creation.
2. Policy updates.
3. Error handling.

[source,python]
----
# Create logger for policy management
policy_logger = logging.getLogger('PolicyLogger')
policy_logger.setLevel(logging.INFO)

# File handler for policy events
policy_file_handler = logging.FileHandler('policy_events.log')
policy_file_handler.setFormatter(logging.Formatter('%(asctime)s - %(levelname)s - %(message)s'))
policy_logger.addHandler(policy_file_handler)

# Policy management functions
def create_policy(policy_id, holder, policy_type):
    policy_logger.info(f"Policy created: ID={policy_id}, Holder={holder}, Type={policy_type}")

def update_policy(policy_id, updates):
    policy_logger.info(f"Policy updated: ID={policy_id}, Updates={updates}")

def handle_error(error_message):
    policy_logger.error(f"Error occurred: {error_message}")

# Simulate events
create_policy("POL12345", "John Doe", "Life")
update_policy("POL12345", {"premium": 1500})
handle_error("Invalid policy ID")
----

=== Step 7: Summary

- **Log Levels**: Use appropriate log levels (DEBUG, INFO, WARNING, ERROR, CRITICAL) based on the severity.
- **Destinations**: Logs can be written to files, consoles, or external systems.
- **Handlers**: Multiple handlers allow flexibility in logging to different destinations.
- **Real-World Application**: Logging helps in tracking events and debugging in systems like insurance management.
